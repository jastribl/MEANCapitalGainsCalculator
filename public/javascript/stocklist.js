// Generated by CoffeeScript 1.9.3
(function() {
  var stockListApp;

  stockListApp = angular.module('stockListApp', []);

  stockListApp.controller('StockListController', function($scope, $http) {
    var resetError, resetForm, resetNewStock, updateStockList;
    updateStockList = function() {
      return $http.get('/api/stockList').then(function(stockList) {
        return $scope.stockList = stockList.data;
      });
    };
    resetNewStock = function() {
      return $scope.newStock = {};
    };
    resetError = function() {
      return $scope.error = null;
    };
    resetForm = function() {
      updateStockList();
      resetNewStock();
      return resetError();
    };
    $scope.remove = function(stockName) {
      return $http["delete"]('/api/stockList?stockName=' + stockName).then(function() {
        updateStockList();
        return $scope.validate();
      });
    };
    $scope.add = function() {
      return $http.post('/api/stockList?stock=' + JSON.stringify($scope.newStock)).then(function() {
        return resetForm();
      });
    };
    $scope.validate = function() {
      var entryIsValid, i, len, newStock, stock, stockList;
      stockList = $scope.stockList;
      newStock = $scope.newStock;
      entryIsValid = true;
      for (i = 0, len = stockList.length; i < len; i++) {
        stock = stockList[i];
        if (stock.stockName === newStock.stockName.toUpperCase()) {
          $scope.error = 'You already have this stock!';
          entryIsValid = false;
          break;
        }
      }
      if (entryIsValid) {
        return resetError();
      }
    };
    return resetForm();
  });

}).call(this);
