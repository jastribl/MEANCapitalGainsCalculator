// Generated by CoffeeScript 1.9.3
(function() {
  var stockListApp;

  stockListApp = angular.module('stockListApp', []);

  stockListApp.controller('StockListController', function($scope, $http) {
    var alreadyHaveStock, refocusForm, resetForm, updateStockList;
    updateStockList = function() {
      return $http.get('/api/stockList').then(function(stockList) {
        return $scope.stockList = stockList.data;
      });
    };
    resetForm = function() {
      return updateStockList().then(function() {
        $scope.validate();
        $scope.newStock = {};
        return $scope.errors = [];
      });
    };
    refocusForm = function() {
      return $('#newStockAutofocusElement').focus();
    };
    $scope.remove = function(stockName) {
      return $http["delete"]('/api/stockList?stockName=' + stockName).then(function() {
        return updateStockList().then(function() {
          $scope.validate();
          return refocusForm();
        });
      });
    };
    $scope.add = function() {
      return $http.post('/api/stockList?stock=' + JSON.stringify($scope.newStock)).then(function() {
        resetForm();
        return refocusForm();
      });
    };
    $scope.validate = function(stock) {
      if (stock) {
        $scope.errors = [];
        if (!stock.stockName && (stock.number || stock.acb)) {
          $scope.errors.push('You must enter a name!');
        }
        if (stock.stockName && alreadyHaveStock(stock)) {
          $scope.errors.push('You already have this stock!');
        }
        if ((stock.number ? !stock.acb : stock.acb)) {
          return $scope.errors.push('You must either fill out both the number and the acb!');
        }
      }
    };
    alreadyHaveStock = function(testStock) {
      var i, len, ref, stock;
      ref = $scope.stockList;
      for (i = 0, len = ref.length; i < len; i++) {
        stock = ref[i];
        if (stock.stockName === testStock.stockName.toUpperCase()) {
          return true;
        }
      }
      return false;
    };
    $scope.validStock = function(stock) {
      if (!stock) {
        return false;
      }
      return !stock.stockName;
    };
    return resetForm();
  });

  stockListApp.filter('moneyFilter', function() {
    return function(number) {
      return '$' + number;
    };
  });

}).call(this);
