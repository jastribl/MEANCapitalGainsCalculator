// Generated by CoffeeScript 1.9.3
(function() {
  var stocksApp;

  stocksApp = angular.module('stocksApp', []);

  stocksApp.filter('moneyFilter', function() {
    return function(number) {
      if (!number) {
        return '$0.00';
      } else {
        return '$' + number;
      }
    };
  });

  stocksApp.controller('StocksController', function($scope, $http) {
    var alreadyHaveStock, refocusForm, resetErrors, resetNewStock;
    $scope.add = function() {
      return $http.post('/api/stocks?stock=' + JSON.stringify($scope.newStock)).then(function(addedStock) {
        $scope.stocks.push(addedStock.data);
        resetNewStock();
        return refocusForm();
      });
    };
    $scope.remove = function(stockName) {
      var i, index, len, ref, stock;
      $http["delete"]('/api/stocks?stockName=' + stockName);
      ref = $scope.stocks;
      for (index = i = 0, len = ref.length; i < len; index = ++i) {
        stock = ref[index];
        if (stock.stockName === stockName) {
          $scope.stocks.splice(index, 1);
          break;
        }
      }
      $scope.validate($scope.newStock);
      refocusForm();
    };
    $scope.validate = function(stock) {
      resetErrors();
      if (!(stock && stock.stockName)) {
        return false;
      }
      if (alreadyHaveStock(stock)) {
        $scope.errors.push('You already have this stock!');
      }
      return $scope.errors.length === 0;
    };
    resetErrors = function() {
      return $scope.errors = [];
    };
    resetNewStock = function() {
      return $scope.newStock = {};
    };
    refocusForm = function() {
      return $('#newStockAutofocusElement').focus();
    };
    alreadyHaveStock = function(testStock) {
      var i, len, ref, stock;
      ref = $scope.stocks;
      for (i = 0, len = ref.length; i < len; i++) {
        stock = ref[i];
        if (stock.stockName === testStock.stockName) {
          return true;
        }
      }
      return false;
    };
    return $http.get('/api/stocks').then(function(stocks) {
      return $scope.stocks = stocks.data;
    });
  });

}).call(this);
